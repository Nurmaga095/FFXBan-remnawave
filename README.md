# Remnawave Observer: –ú–æ–¥—É–ª—å –¥–ª—è –±–æ—Ä—å–±—ã —Å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–æ–∫

![Go](https://img.shields.io/badge/Go-1.24-00ADD8?style=for-the-badge&logo=go)
![Docker](https://img.shields.io/badge/Docker-28.0-2496ED?style=for-the-badge&logo=docker)
![RabbitMQ](https://img.shields.io/badge/RabbitMQ-4.1-FF6600?style=for-the-badge&logo=rabbitmq)
![Redis](https://img.shields.io/badge/Redis-8.2-DC382D?style=for-the-badge&logo=redis)
![nftables](https://img.shields.io/badge/nftables-1.0.9-orange?style=for-the-badge)

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**Remnawave Observer** ‚Äî —ç—Ç–æ –≤–Ω–µ—à–Ω–∏–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Remnawave. –ï–≥–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª—è—Ç—Å—è —Å–≤–æ–µ–π –ø–æ–¥–ø–∏—Å–∫–æ–π —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏–º –¥–æ—Å—Ç—É–ø. –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, —Å –∫–∞–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è –≤—Å–µ—Ö IP-–∞–¥—Ä–µ—Å–æ–≤ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –≤–∞—à —Å–µ—Ä–≤–∏—Å –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ—Ç–µ—Ä–∏ –¥–æ—Ö–æ–¥–∞.

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –∞ –∑–∞—Ç–µ–º –¥–µ–ª–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–æ–º —Å –¥—Ä—É–∑—å—è–º–∏, —Å–µ–º—å–µ–π –∏–ª–∏ –ø—Ä–æ–¥–∞–µ—Ç –µ–≥–æ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º, —Å–µ—Ä–≤–∏—Å —Ç–µ—Ä—è–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –¥–æ—Ö–æ–¥. –†—É—á–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–∞–∫–∏—Ö –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏ —Ç—Ä–µ–±—É–µ—Ç –æ–≥—Ä–æ–º–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç.

## –†–µ—à–µ–Ω–∏–µ

Remnawave Observer –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ –≤–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º (–Ω–æ–¥–∞–º) –∏ –ø—Ä–∏–Ω–∏–º–∞—è –º–µ—Ä—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —á–∞—Å—Ç–µ–π: —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ **—Å–µ—Ä–≤–µ—Ä–∞-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è (Observer)** –∏ **–∞–≥–µ–Ω—Ç–æ–≤-–±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ (Blocker)**, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–π –≤–∞—à–µ–π –Ω–æ–¥–µ (—Å–µ—Ä–≤–µ—Ä–µ —Å Xray).

–í–æ—Ç –ø–æ—à–∞–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:

1.  **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–π –∏–∑ –≤–∞—à–∏—Ö `remnanode` (—Å–µ—Ä–≤–µ—Ä—É —Å Xray). Xray –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –ª–æ–≥-—Ñ–∞–π–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏: –≤—Ä–µ–º—è, IP-–∞–¥—Ä–µ—Å –∏ `email` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2.  **–ü–∞—Ä—Å–∏–Ω–≥ –ª–æ–≥–æ–≤**: –ù–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–µ–≥–∫–∏–π —Å–µ—Ä–≤–∏—Å `Vector`. –û–Ω –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ —á–∏—Ç–∞–µ—Ç –ª–æ–≥-—Ñ–∞–π–ª Xray, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ –Ω–µ–≥–æ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (`email` –∏ `IP-–∞–¥—Ä–µ—Å`) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å.
3.  **–ê–Ω–∞–ª–∏–∑ –∏ –ø–æ–¥—Å—á–µ—Ç**: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä `Observer` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –≤—Å–µ—Ö –Ω–æ–¥. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `Redis` –¥–ª—è –≤–µ–¥–µ–Ω–∏—è —É—á–µ—Ç–∞: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`email`) –æ–Ω —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤, —Å –∫–æ—Ç–æ—Ä—ã—Ö –±—ã–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –°–∏—Å—Ç–µ–º–∞ —É–º–Ω–∞—è: –¥–∞–∂–µ –µ—Å–ª–∏ —É –≤–∞—Å 10 –Ω–æ–¥ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏, `Observer` –Ω–µ —Å–æ–∑–¥–∞—Å—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –±—É–¥–µ—Ç –≤–µ—Å—Ç–∏ –µ–¥–∏–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ IP –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
4.  **–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è**: `Observer` –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ IP-–∞–¥—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ª–∏–º–∏—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12 IP).
5.  **–ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É**: –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω, `Observer` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π `RabbitMQ`. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö IP-–∞–¥—Ä–µ—Å–æ–≤ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è.
6.  **–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: –ê–≥–µ–Ω—Ç `Blocker` –Ω–∞ *–∫–∞–∂–¥–æ–π* –≤–∞—à–µ–π –Ω–æ–¥–µ –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç—É –∫–æ–º–∞–Ω–¥—É. –û–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ IP-–∞–¥—Ä–µ—Å–∞ –∏–∑ –∫–æ–º–∞–Ω–¥—ã –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π "—á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫" –≤ `nftables` (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π—Ä–≤–æ–ª –≤ Linux).
7.  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `nftables` –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–π —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç —ç—Ç–∏—Ö IP-–∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Ç–µ, —Å –∫–µ–º –æ–Ω –ø–æ–¥–µ–ª–∏–ª—Å—è –¥–æ—Å—Ç—É–ø–æ–º, —Ç–µ—Ä—è—é—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

### –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```
[ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 (IP: A) ] ----> [ Remnanode 1 ]
                                      |
[ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 (IP: B) ] ----> [ Remnanode 2 ]
                                      |
[ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1 (IP: C) ] ----> [ Remnanode 3 ]
                                      |
                                      V
+-----------------------------------------------------------------------------+
| –ù–∞ –∫–∞–∂–¥–æ–π Remnanode:                                                        |
|   1. Xray (–ø–∏—à–µ—Ç –≤ access.log)                                              |
|   2. Vector (–ø–∞—Ä—Å–∏—Ç –ª–æ–≥ -> {email, ip}) ----> [ Nginx –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Observer ] |
|   3. Blocker (—Å–ª—É—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç RabbitMQ)                                  |
|   4. nftables (—Ñ–∞–π—Ä–≤–æ–ª —Å —á–µ—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º `user_blacklist`)                   |
+-----------------------------------------------------------------------------+
                                      |
                                      V
+-------------------------------------------------------------------------+
| –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Observer:                                            |
|   1. Nginx (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Vector'–æ–≤)                              |
|   2. Vector Aggregator (–ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Observer Service)             |
|   3. Observer Service (–≥–ª–∞–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)                                  |
|      |-> [ Redis ] (—Ö—Ä–∞–Ω–∏—Ç: user -> {IP1, IP2, ...})                    |
|      |                                                                  |
|      +-- (–ï—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω) --> [ RabbitMQ ] (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É)    |
|                                         |                               |
|   4. RabbitMQ (–±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π) -------+--> (–ö–æ–º–∞–Ω–¥–∞ –≤—Å–µ–º Blocker'–∞–º)  |
+-------------------------------------------------------------------------+
```

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –°–µ—Ä–≤–µ—Ä –¥–ª—è Observer (–ø–∞–Ω–µ–ª—å)

*   **–û–°**: Debian 12
*   **RAM**: 2 GB
*   **CPU**: 1 vCPU

### 2. –°–µ—Ä–≤–µ—Ä –¥–ª—è Remnanode (–∫–∞–∂–¥–∞—è –Ω–æ–¥–∞ —Å Xray)

*   **–û–°**: Debian 12
*   **RAM**: 1 GB
*   **CPU**: 1 vCPU
*   **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∏ –≤–∫–ª—é—á–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç `nftables`.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Observer (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å)

1.  –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É, –≥–¥–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å Observer.
2.  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `docker` –∏ `docker-compose`.
3.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `observer_conf` –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `scp` –∏–ª–∏ `git clone`).
    ```bash
    # –ü—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–ª–∏ –≤–µ—Å—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    cd *repo*/observer_conf
    ```
4.  –°–æ–∑–¥–∞–π—Ç–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    ```bash
    cp .env.example .env
    vim .env
    ```
    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
    *   `MAX_IPS_PER_USER`: –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **12** –∏–ª–∏ –≤—ã—à–µ. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–µ–∑ –ø—Ä–æ–±–ª–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –¥–æ–º–∞—à–Ω–∏–º Wi-Fi, –º–æ–±–∏–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º (LTE), —Ä–∞–±–æ—á–∏–º Wi-Fi –∏ —Ç.–¥.
    *   `ALERT_WEBHOOK_URL`: URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Telegram shop bot).
    *   `EXCLUDED_USERS`: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `self,13_12143423`).
    *   `EXCLUDED_IPS`: **–í–ê–ñ–ù–û!** IP-–∞–¥—Ä–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å IP-–∞–¥—Ä–µ—Å–∞ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –Ω–æ–¥ –∏ —Å–µ—Ä–≤–µ—Ä–∞ Observer, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `8.8.8.8,1.1.1.1,192.168.1.1`).
    *   `USER_IP_TTL_SECONDS`: –£–∫–∞–∂–∏—Ç–µ TTL, –ö–∞–∫ –¥–æ–ª–≥–æ –±—É–¥–µ—Ç –∂–∏—Ç—å "–æ—Ç–ø–µ—á–∞—Ç–æ–∫" –∏–ø –∞–¥—Ä–µ—Å–∞ —é–∑–µ—Ä–∞, –¥–æ —Ç–æ–≥–æ –∫–∞–∫ –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∏–∑ —Ä–µ–¥–∏—Å, (–†–µ–∫–æ–º–µ–Ω–¥—É—é 86400, —Ç.–µ 1 —á–∞—Å)
    *   `CLEAR_IPS_DELAY_SECONDS`: –¢–∞–π–º–∞—É—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–ø–µ—á–∞—Ç–∫–∞ –∏–ø –∞–¥—Ä–µ—Å–∞ –≤ —Ä–µ–¥–∏—Å, –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —é–∑–µ—Ä–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É—é 30 —Å–µ–∫—É–Ω–¥)
    *   `RABBIT_USER`, `RABBIT_PASSWD`: –°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è RabbitMQ.
    *   `RABBITMQ_URL`: –°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ URL –¥–ª—è **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–º Observer. –ü—Ä–∏–º–µ—Ä: `amqp://myuser:mypassword@rabbitmq:5672/`.

5.  –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx. –í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–æ–º–µ–Ω –∏ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç Let's Encrypt).
    ```bash
    vim nginx.conf
    ```
    –ó–∞–º–µ–Ω–∏—Ç–µ –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è `HEAD_DOMAIN` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (`fullchain.pem` –∏ `privkey.pem`) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø—É—Ç—è–º `/etc/letsencrypt/live/HEAD_DOMAIN/`.

6.  **–í–∞–∂–Ω–æ!** –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –Ω–æ–¥ –∫ RabbitMQ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç `5671` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è AMQPS) –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ Observer –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ. –í–∞–º –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ —Å–∞–º–æ–≥–æ RabbitMQ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SSL.

7.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
    ```bash
    docker-compose up -d
    ```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–∂–¥–æ–π Remnanode (–Ω–æ–¥—ã —Å Xray)

–ù–∞ *–∫–∞–∂–¥–æ–º* —Å–µ—Ä–≤–µ—Ä–µ, –≥–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç Xray, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è.

#### 2.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞ `nftables`

–≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π** —à–∞–≥. `Blocker` –∂–µ—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –ø—Ä–∞–≤–∏–ª –≤ `nftables`.

**!! –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥—Ä—É–≥–∏–µ —Ñ–∞–µ—Ä–≤–æ–ª—ã –ø–æ —Ç–∏–ø—É ufw –∏–ª–∏ iptables !!**

1.  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `nftables`:
    ```bash
    apt update && apt install nftables -y
    ```

2.  –°–æ–∑–¥–∞–π—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
    ```bash
    vim /etc/nftables.conf
    ```

3.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ –Ω–µ–≥–æ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ —Ñ–∞–π–ª–∞ `nftables_example.conf`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

4.  **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/nftables.conf`**:
    *   –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É `define SSH_PORT = 22` –∏ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SSH-–ø–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–æ–¥–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤–∞—à SSH –ø–æ—Ä—Ç 6666, –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `define SSH_PORT = 6666`.
    *   –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `set control_plane_sources` –∏ –≤ `elements = { IP_ADRESS }` –≤–ø–∏—à–∏—Ç–µ IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ **Observer** –∏ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è **Remnawave**.
    *   –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `set monitoring_sources` –∏ –≤ `elements = { IP_ADRESS }` –≤–ø–∏—à–∏—Ç–µ IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.

5.  –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ `nftables` –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:
    ```bash
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Ñ–∞–π–ª–∞
    nft -f /etc/nftables.conf

    # –í–∫–ª—é—á–∞–µ–º —Å–µ—Ä–≤–∏—Å –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
    systemctl enable --now nftables
    ```
    **–í–Ω–∏–º–∞–Ω–∏–µ!** `Blocker` –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å IP-–∞–¥—Ä–µ—Å–∞ –≤ –Ω–∞–±–æ—Ä `set user_blacklist` –≤ —Ç–∞–±–ª–∏—Ü–µ `table inet firewall`. –ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —ç—Ç–∏ –∏–º–µ–Ω–∞, –∏–Ω–∞—á–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç.

#### 2.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Blocker –∏ Vector –≤ Remnanode

–°–µ—Ä–≤–∏—Å—ã `blocker-xray` –∏ `vector` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `docker-compose.yml` —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç `remnanode` (–æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/opt/remnanode/`).

1.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–∞—à–µ–π –Ω–æ–¥—ã:
    ```bash
    cd /opt/remnanode/
    ```

2.  –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö RabbitMQ:
    ```bash
    vim .env
    ```
    –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É, –∑–∞–º–µ–Ω–∏–≤ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–∏:
    ```
    # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª amqps –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    RABBITMQ_URL=amqps://–í–ê–®_RABBIT_USER:–í–ê–®_RABBIT_PASSWD@–í–ê–®_–î–û–ú–ï–ù_OBSERVER:5671/
    ```

3.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è Vector –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –≤—ã —Å–∫–∞—á–∞–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
    ```bash
    # –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∏–∑ —Å–∫–∞—á–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É
    cp /path/to/remnawave-observer-main/blocker_conf/vector/vector.toml ./vector.toml
    ```

4.  –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `vector.toml`:
    ```bash
    vim vector.toml
    ```
    –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É `uri = "https://HEAD_DOMAIN:38213/"` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `HEAD_DOMAIN` –Ω–∞ –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ Observer.

5.  –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `docker-compose.yml` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/opt/remnanode/docker-compose.yml`).

6.  –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å—ã `blocker-xray` –∏ `vector` –≤ –∫–æ–Ω–µ—Ü —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç—Å—Ç—É–ø—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É YAML.

    ```yaml
    # ... –≤–∞—à —Å–µ—Ä–≤–∏—Å remnanode –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã ...

      blocker-xray:
        container_name: blocker-xray
        hostname: blocker-xray
        image: quay.io/0fl01/blocker-xray-go:0.0.6
        restart: unless-stopped
        network_mode: host
        logging:
          driver: "json-file"
          options:
            max-size: "8m"
            max-file: "5"
        env_file:
          - .env
        cap_add:
          - NET_ADMIN
          - NET_RAW
        depends_on:
          - remnanode
        deploy:
          resources:
            limits:
              memory: 64M
              cpus: '0.25'
            reservations:
              memory: 32M
              cpus: '0.10'

      vector:
        image: timberio/vector:0.48.0-alpine
        container_name: vector
        hostname: vector
        restart: unless-stopped
        network_mode: host
        command: ["--config", "/etc/vector/vector.toml"]
        depends_on:
          - remnanode
        volumes:
          # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É vector.toml, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ —à–∞–≥–µ 4
          - ./vector.toml:/etc/vector/vector.toml:ro
          # –ü—É—Ç—å –∫ –ª–æ–≥–∞–º remnanode, –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ –≤ —Å–µ—Ä–≤–∏—Å–µ remnanode
          - /var/log/remnanode:/var/log/remnanode:ro
        logging:
          driver: "json-file"
          options:
            max-size: "8m"
            max-file: "3"
        deploy:
          resources:
            limits:
              memory: 128M
              cpus: '0.25'
            reservations:
              memory: 64M
              cpus: '0.10'
    ```

7.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–∏—Å `remnanode` –≤ —ç—Ç–æ–º –∂–µ `docker-compose.yml` –∏–º–µ–µ—Ç volume –¥–ª—è –ª–æ–≥–æ–≤, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ: `volumes: - /var/log/remnanode:/var/log/remnanode`.

8.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
    ```bash
    docker-compose up -d
    ```

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ **–®–∞–≥ 2** –¥–ª—è –≤—Å–µ—Ö –≤–∞—à–∏—Ö –Ω–æ–¥.

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

*   **Debian 12**: –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. –í—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–ª–∏—Å—å –∏–º–µ–Ω–Ω–æ –Ω–∞ –Ω–µ–π.
*   **Ubuntu 24.04**: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã Linux (—Ç–∞–∫–∏–µ –∫–∞–∫ `nftables`). –û–¥–Ω–∞–∫–æ –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, –∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏. **–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Debian 12 –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π —Ä–∞–±–æ—Ç—ã.**


---


### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram —á–µ—Ä–µ–∑ Webhook

Remnawave Observer –Ω–µ —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–∏—Ç–µ–ª–µ–π, –Ω–æ –∏ –º–æ–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≤–∞—Å –æ–± —ç—Ç–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫–∏. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–∞—à–∏–º Telegram-–±–æ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥–∞–∂–µ–π –ø–æ–¥–ø–∏—Å–æ–∫.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1.  –ö–æ–≥–¥–∞ `Observer` –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–≤—ã—Å–∏–ª –ª–∏–º–∏—Ç IP-–∞–¥—Ä–µ—Å–æ–≤, –æ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST`-–∑–∞–ø—Ä–æ—Å –Ω–∞ URL, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑–∞–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
2.  –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç JSON-—Ç–µ–ª–æ —Å–æ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`AlertPayload`):**

```json
{
  "user_identifier": "54_217217281",
  "detected_ips_count": 13,
  "limit": 12,
  "all_user_ips": [
    "1.1.1.1",
    "2.2.2.2",
    "3.3.3.3"
  ],
  "block_duration": "5m",
  "violation_type": "ip_limit_exceeded"
}
```

*   `user_identifier`: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ–≥–æ username).
*   `detected_ips_count`: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   `limit`: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç IP –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   `all_user_ips`: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö IP-–∞–¥—Ä–µ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.
*   `block_duration`: –ù–∞ –∫–∞–∫–æ–π —Å—Ä–æ–∫ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.
*   `violation_type`: –¢–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è.

#### –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –≤–∞—à–µ–º—É Telegram-–±–æ—Ç—É?

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –≤–∞—Å –µ—Å—Ç—å –±–æ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø–æ–¥–ø–∏—Å–æ–∫. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—É—á–∏—Ç—å –µ–≥–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç—Ç–∏ –≤–µ–±—Ö—É–∫–∏ –∏ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–∏—Ö.

**–®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç (endpoint) –≤ –≤–∞—à–µ–º –±–æ—Ç–µ**

–í–∞—à –±–æ—Ç –¥–æ–ª–∂–µ–Ω "—Å–ª—É—à–∞—Ç—å" –≤—Ö–æ–¥—è—â–∏–µ POST-–∑–∞–ø—Ä–æ—Å—ã –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –∞–¥—Ä–µ—Å—É. –ù–∞–ø—Ä–∏–º–µ—Ä, `https://bot.yourdomain.com/webhook/alert`. –≠—Ç–æ—Ç –∞–¥—Ä–µ—Å –≤—ã –∏ —É–∫–∞–∂–µ—Ç–µ –≤ `ALERT_WEBHOOK_URL`.

*   –í –∫–æ–¥–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ (–Ω–∞ Python, Go, Node.js –∏ —Ç.–¥.) —Å–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —ç—Ç–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `POST`-–∑–∞–ø—Ä–æ—Å—ã.

**–®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Observer**

–í —Ñ–∞–π–ª–µ `observer_conf/.env` –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ Observer —É–∫–∞–∂–∏—Ç–µ URL –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞:
```
ALERT_WEBHOOK_URL=https://bot.yourdomain.com/webhook/alert
```
**–°–æ–≤–µ—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** –ß—Ç–æ–±—ã –Ω–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π –Ω–µ –º–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–µ–π–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ URL:
`ALERT_WEBHOOK_URL=https://bot.yourdomain.com/webhook/alert/a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8`

**–®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–µ**

–ö–æ–≥–¥–∞ –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –≤–µ–±—Ö—É–∫, –µ–≥–æ –∫–æ–¥ –¥–æ–ª–∂–µ–Ω:
1.  –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON-—Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞.
2.  –ò–∑–≤–ª–µ—á—å –∏–∑ –Ω–µ–≥–æ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (`user_identifier`, `detected_ips_count` –∏ —Ç.–¥.).
3.  –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –≤ –Ω—É–∂–Ω—ã–π —á–∞—Ç.

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –±–æ—Ç:**

> üö® **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ!**
>
> **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `15_327832732`
> **–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç IP-–∞–¥—Ä–µ—Å–æ–≤:** **13 / 12**
>
> –í—Å–µ IP-–∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ **5m**.

**–®–∞–≥ 4: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–æ–≥–∏–∫–æ–π –±–æ—Ç–∞**

–ò—Å–ø–æ–ª—å–∑—É—è `user_identifier` (email), –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
*   –ü–æ–º–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –∫–∞–∫ "–Ω–∞—Ä—É—à–∏—Ç–µ–ª—è".
*   –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å–∞–º–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
---

### –î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å–≤—è–∑–∫–∏ Nginx + Vector

–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞–¥–µ–∂–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–∞–∂–¥–æ–π `remnanode` –∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É `Observer` –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –ø–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É. –î–ª—è —ç—Ç–æ–≥–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤—è–∑–∫—É –∏–∑ Nginx (–≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ —Å SSL) –∏ Vector.

**–û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

`Vector (–Ω–∞ Remnanode)` -> `–ò–Ω—Ç–µ—Ä–Ω–µ—Ç (HTTPS)` -> `Nginx (–Ω–∞ Observer)` -> `Vector-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä (–Ω–∞ Observer)` -> `Observer Service`

#### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Observer

–ù–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ Nginx –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1.  **–¢–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ SSL**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –Ω–æ–¥, —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –µ–≥–æ —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.
2.  **–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–µ—Ä–µ–¥–∞–µ—Ç —É–∂–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π, "—á–∏—Å—Ç—ã–π" HTTP-—Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —Å–µ—Ä–≤–∏—Å `vector-aggregator`, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ Docker-—Å–µ—Ç–∏ –∏ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –Ω–∞–ø—Ä—è–º—É—é.

##### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è docker compose (`observer_conf/docker-compose.yml`)

```yml
services:
  observer-remna:
    container_name: observer-remna
    image: quay.io/0fl01/observer-xray-go:0.0.19
    restart: unless-stopped
    expose:
      - "9000"
    env_file:
      - .env
    depends_on:
      rabbitmq-obs:
        condition: service_healthy
      vector-aggregator:
        condition: service_started
      redis-obs:
        condition: service_started
    networks:
      - observer-net
      - remnawave-network
    logging:
      driver: json-file
      options:
        max-size: "8m"
        max-file: "3"

  rabbitmq-obs:
    image: rabbitmq:4.1.2-alpine
    container_name: rabbitmq-obs
    restart: unless-stopped
    expose:
      - "5672"
      - "15672"
    volumes:
      - rabbitmq-obs-data:/var/lib/rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=chumba
      - RABBITMQ_DEFAULT_PASS=${RABBIT_PASSWD}
    networks:
      - observer-net
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s

  vector-aggregator:
    image: timberio/vector:0.48.0-alpine
    container_name: vector-aggregator
    restart: unless-stopped
    volumes:
      - ./vector.toml:/etc/vector/vector.toml:ro
    expose:
      - "8686"
    command: ["--config", "/etc/vector/vector.toml"]
    networks:
      - observer-net
    logging:
      driver: json-file
      options:
        max-size: "8m"
        max-file: "3"

  nginx-obs:
    image: nginx:mainline-alpine
    container_name: nginx-obs
    restart: unless-stopped
    ports:
      - "38213:38213"  # Vector HTTPS
      - "38214:38214"  # RabbitMQ AMQP SSL
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
    depends_on:
      vector-aggregator:
        condition: service_started
      rabbitmq-obs:
        condition: service_healthy 
    networks:
      - observer-net
    logging:
      driver: json-file
      options:
        max-size: "8m"
        max-file: "3"

  redis-obs:
    image: redis:8.2-m01-alpine3.22
    container_name: redis-obs
    restart: unless-stopped
    expose:
      - "6379"
    volumes:
      - redis-obs-data:/data
    networks:
      - observer-net
    logging:
      driver: json-file
      options:
        max-size: "8m"
        max-file: "3"

networks:
  observer-net:
    driver: bridge
  remnawave-network:
    external: true

volumes:
  redis-obs-data:
  rabbitmq-obs-data:
```

##### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx (`observer_conf/nginx.conf`)

```nginx
user nginx;
worker_processes auto;
pid /var/run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 1024;
}

# Stream –±–ª–æ–∫ –¥–ª—è AMQP —Å SSL
stream {
    # AMQP –ø–æ—Ä—Ç —Å SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–µ–π
    server {
        listen 38214 ssl;
        
        ssl_certificate /etc/letsencrypt/live/HEAD_DOMAIN/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/HEAD_DOMAIN/privkey.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL_STREAM:10m;
        ssl_session_timeout 10m;
        ssl_handshake_timeout 10s;

        proxy_pass rabbitmq-obs:5672;
        proxy_timeout 300s;
        proxy_connect_timeout 5s;
    }
}

# HTTP –±–ª–æ–∫ –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                   '$status $body_bytes_sent "$http_referer" '
                   '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log warn;

    # Vector –Ω–∞ –ø–æ—Ä—Ç—É 38213
    server {
        listen 38213 ssl;
        http2 on;
        server_name HEAD_DOMAIN;

        ssl_certificate /etc/letsencrypt/live/HEAD_DOMAIN/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/HEAD_DOMAIN/privkey.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL_HTTP:10m;
        ssl_session_timeout 10m;

        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        location / {
            proxy_pass http://vector-aggregator:8686;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_redirect off;
        }
    }

    # RabbitMQ Management UI –Ω–∞ –ø–æ—Ä—Ç—É 38215
    server {
        listen 38215 ssl;
        http2 on;
        server_name HEAD_DOMAIN;

        ssl_certificate /etc/letsencrypt/live/HEAD_DOMAIN/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/HEAD_DOMAIN/privkey.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL_HTTP:10m;
        ssl_session_timeout 10m;

        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        location / {
            proxy_pass http://rabbitmq-obs:15672;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_redirect off;
            
            # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket –¥–ª—è RabbitMQ Management
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_cache_bypass $http_upgrade;
        }
    }
}
```

##### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vector-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞ (`observer_conf/vector.toml`)

–≠—Ç–æ—Ç Vector —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–∏–µ–º–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Nginx –∏ –ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ `observer`.

```toml
# –ò—Å—Ç–æ—á–Ω–∏–∫: –ø—Ä–∏–Ω–∏–º–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ HTTP –æ—Ç Nginx.
[sources.http_receiver]
  type = "http"
  # –°–ª—É—à–∞–µ–º –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –í–ù–£–¢–†–ò Docker-—Å–µ—Ç–∏ –Ω–∞ –ø–æ—Ä—Ç—É 8686
  # –ò–º–µ–Ω–Ω–æ —Å—é–¥–∞ Nginx –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫
  address = "0.0.0.0:8686"
  decoding.codec = "json"

# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Ä–≤–∏—Å-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å.
[sinks.observer_service]
  type = "http"
  inputs = ["http_receiver"]
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ 'observer' –∏–∑ docker-compose –∏ –µ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç
  # –≠—Ç–æ —É–∂–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
  uri = "http://observer:9000/log-entry"
  method = "post"
  encoding.codec = "json"

  batch.max_events = 100
  batch.timeout_secs = 5

```

#### –ù–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ (Remnanode)

–ù–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ Vector —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∞–≥–µ–Ω—Ç: –æ–Ω —á–∏—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ Observer.

##### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vector-–∞–≥–µ–Ω—Ç–∞ (`blocker_conf/vector/vector.toml`)

```toml
# –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: —á–∏—Ç–∞–µ–º access.log –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ remnanode.
[sources.xray_access_logs]
  type = "file"
  include = ["/var/log/remnanode/access.log"] 
  read_from = "end"

# –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è: –ø–∞—Ä—Å–∏–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –ª–æ–≥–∞, —á—Ç–æ–±—ã –∏–∑–≤–ª–µ—á—å email –∏ IP.
[transforms.parse_xray_log]
  type = "remap"
  inputs = ["xray_access_logs"]
  source = '''
    pattern = r'from (tcp:)?(?P<ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):\d+.*? email: (?P<email>\S+)'
    parsed, err = parse_regex(.message, pattern)
    if err != null {
      log("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Å—Ç—Ä–æ–∫—É –ª–æ–≥–∞: " + err, level: "warn")
      abort
    }
    . = { "user_email": parsed.email, "source_ip": parsed.ip, "timestamp": to_string(now()) }
  '''

# –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–∞—à —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å.
[sinks.central_observer_api]
  type = "http"
  inputs = ["parse_xray_log"]
  # –í–ê–ñ–ù–û: –£–∫–∞–∑—ã–≤–∞–µ–º HTTPS –∏ –≤–∞—à –¥–æ–º–µ–Ω!
  # Vector –Ω–∞ –Ω–æ–¥–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –∞–¥—Ä–µ—Å—É —Å–µ—Ä–≤–µ—Ä–∞ Observer.
  # –ó–∞–ø—Ä–æ—Å —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ Nginx, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 443 (–≤ docker-compose –æ–Ω –ø—Ä–æ–±—Ä–æ—à–µ–Ω –∫–∞–∫ 38213:443).
  # –ü–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 38213.
  uri = "https://HEAD_DOMAIN:38213/"
  method = "post"
  encoding.codec = "json"
  compression = "gzip"

  [sinks.central_observer_api.batch]
    max_events = 100
    timeout_secs = 5

  [sinks.central_observer_api.request]
    retry_attempts = 5
    retry_backoff_secs = 2

  [sinks.central_observer_api.tls]
```


---

## –°–≤—è–∑—å —Å –∞–≤—Ç–æ—Ä–æ–º

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É –≤ —Ä–∞–±–æ—Ç–µ –º–æ–¥—É–ª—è, –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π –Ω–∞–ø—Ä—è–º—É—é.

–Ø –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è:
- –í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ –Ω–æ–≤–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É.
- –°–æ–æ–±—â–µ–Ω–∏–π –æ –±–∞–≥–∞—Ö –∏ –æ—à–∏–±–∫–∞—Ö.
- –í–æ–ø—Ä–æ—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞.

[![Telegram](https://img.shields.io/badge/Telegram-OFL01-2CA5E0?style=for-the-badge&logo=telegram&logoColor=white)](https://t.me/OFL01)