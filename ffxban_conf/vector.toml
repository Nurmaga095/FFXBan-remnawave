# Vector Aggregator (Observer-сервер)
# Принимает батчи логов от нод (через Nginx по HTTPS) и передаёт в ffxban

# ─── Источник: HTTP от Nginx ────────────────────────────────────────────────
[sources.http_receiver]
  type = "http"
  # Слушаем на всех интерфейсах Docker-сети на порту 8686
  address = "0.0.0.0:8686"
  decoding.codec = "json"

# ─── Назначение: ffxban Observer ────────────────────────────────────────────
[sinks.ffxban]
  type = "http"
  inputs = ["http_receiver"]
  uri = "http://ffxban:9000/log-entry"
  method = "post"
  encoding.codec = "json"

  [sinks.ffxban.batch]
    max_events   = 100
    timeout_secs = 5

  [sinks.ffxban.request]
    retry_attempts     = 3
    retry_backoff_secs = 1
    timeout_secs       = 10
